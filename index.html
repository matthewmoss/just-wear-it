<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="p5.js"></script>
    <script src="p5.sound.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ðŸ˜· JustWearIt.FYI</title>
  </head>
  <body>
    <script src="simulation.js"></script>
    <div id="config-popover">
      <div id="config-popover-container">
        <div class="config-row">
          <p id="config-header" class="config-title">Configuration</p>
          <a onclick="saveConfigChanges()" id="config-save" class="config-input">Save</a>
        </div>
        <div class="config-row">
          <p class="config-title">Mask Usage Percentage</p>
          <input id="mask-percentage" type="number" class="config-input" min="10" max="100" value="100">
        </div>
        <div class="config-row">
          <p class="config-title">Mask Effectiveness</p>
          <input id="mask-effectiveness" type="number" class="config-input" min="1" max="100" value="70">
        </div>
        <div class="config-row">
          <p class="config-title">Transmission Rate</p>
          <input id="transmission-rate" type="number" class="config-input" min="1" max="100" step="0.1" value="3.7">
        </div>
        <div class="config-row">
          <p class="config-title">Transmission Distance</p>
          <input id="transmission-distance" type="number" class="config-input" min="1" max="100" value="7" step="0.5">
        </div>
        <div class="config-row">
          <p class="config-title">Initial Popation Health</p>
          <input id="population-health" type="number" class="config-input" min="1" max="100" value="92">
        </div>
        <div class="config-row">
          <p class="config-title">Recovery Percentage</p>
          <input id="recovery-percentage" type="number" class="config-input" min="1" max="100" value="95">
        </div>
        <div class="config-row">
          <p class="config-title">Avg Illnes Duration</p>
          <input id="illness-duration" type="number" class="config-input" min="1" max="10" value="4" step="0.1">
        </div>
        <div class="config-row">
          <p class="config-title">Seconds Per Week</p>
          <input id="seconds-per-week" type="number" class="config-input" min="1" max="20" value="8" step="0.1">
        </div>
        <div class="config-row">
          <p class="config-title">Speed</p>
          <input id="speed" type="number" class="config-input" min="1" max="10" step="1" value="2">
        </div>
        <div class="config-row">
          <p class="config-title">Density</p>
          <input id="density" type="number" class="config-input" min="1" max="100" step="1" value="25">
        </div>
      </div>
    </div>
    <div class="footer">
      <div id="navigation" class="banner">
        <div class="banner-block">
          <p id="title">JustWearIt.FYI</p>
          <p id="share"><a href="#">Share</a></p>
          <p id="donate"><a href="https://www.omaze.com/collections/coronavirus-covid-19-donations" target="blank">Donate</a></p>
        </div>
        <div class="banner-block">
          <p><a id="scroll" href="#">Scroll To Learn More</a></p>
          <svg id="scroll-icon" width="10" height="19" viewBox="0 0 10 19" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 7L5 11L9 7" stroke="white" stroke-opacity="0.6" stroke-width="2"/>
            <path d="M1 1L5 5L9 1" stroke="white" stroke-opacity="0.4" stroke-width="2"/>
            <path d="M1 13L5 17L9 13" stroke="white" stroke-opacity="0.8" stroke-width="2"/>
          </svg>
        </div>
        <div id="config-section" class="banner-block">
          <p id="config-summary">100% Mask Usage, 70% Effective</p>
          <p onclick="toggleConfig()"><a id="config" href="#">Configure</a></p>
        </div>
      </div>
      <div id="mini-navigation" class="banner">
        <div class="banner-block">
          <p><a id="scroll" href="#">Learn More</a></p>
          <svg id="scroll-icon" width="10" height="19" viewBox="0 0 10 19" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 7L5 11L9 7" stroke="white" stroke-opacity="0.6" stroke-width="2"/>
            <path d="M1 1L5 5L9 1" stroke="white" stroke-opacity="0.4" stroke-width="2"/>
            <path d="M1 13L5 17L9 13" stroke="white" stroke-opacity="0.8" stroke-width="2"/>
          </svg>
        </div>
        <div id="config-section" class="banner-block">
          <p id="config-summary-compact">100% Mask Usage<br>70% Effective</p>
          <img onclick="toggleConfig()" src="/assets/settings.svg" />
        </div>
      </div>
    </div>

    <script>

      //
      // Keyboard
      //

      // Pause / play on spacebar
      document.addEventListener('keyup', event => {
        console.log("key code: " + event.keyCode);
        if (event.keyCode == 32) {
          togglePause();
        } else if (event.keyCode == 13) {
          saveConfigChanges();
        }
      })

      //
      // Config
      //
      function toggleConfig() {
        let popover = document.getElementById("config-popover");
        if (popover.style.visibility === "visible") {
          popover.style.visibility = "hidden";
          updateForConfigChange(); // Update UI for config changes
        } else {
          popover.style.visibility = "visible";
        }
      }

      // Save config changes
      function saveConfigChanges() {

        // Update simulation
        setMaskPercentage(document.getElementById("mask-percentage").value);
        setMaskEffectiveness(document.getElementById("mask-effectiveness").value);
        setTransmissionRate(document.getElementById("transmission-rate").value);
        setTransmissionDistance(document.getElementById("transmission-distance").value);
        setPopulationHealth(document.getElementById("population-health").value);
        setRecoveryPercentage(document.getElementById("recovery-percentage").value);
        setIllnessDuration(document.getElementById("illness-duration").value);
        setSecondsPerWeek(document.getElementById("seconds-per-week").value);
        setSpeed(document.getElementById("speed").value);
        setDensity(document.getElementById("density").value);        

        // Restart
        restartSimulation();

        // Hide config popover, which will update UI for config changes
        toggleConfig()
      }

      // Update UI for config change
      function updateForConfigChange() {

        document.getElementById("config-summary").innerHTML = `${maskPercentage()}% Mask Usage, ${maskEffectiveness()}% Effective`;
        document.getElementById("config-summary-compact").innerHTML = `${maskPercentage()}% Mask Usage<br>${maskEffectiveness()}% Effective`;

        document.getElementById("mask-percentage").value = maskPercentage();
        document.getElementById("mask-effectiveness").value = maskEffectiveness();
        document.getElementById("transmission-rate").value = transmissionRate().toFixed(1);
        document.getElementById("transmission-distance").value = transmissionDistance();
        document.getElementById("population-health").value = populationHealth();
        document.getElementById("recovery-percentage").value = recoveryPercentage();
        document.getElementById("illness-duration").value = illnessDuration();
        document.getElementById("seconds-per-week").value = secondsPerWeek();
        document.getElementById("speed").value = speed();
        document.getElementById("density").value = density().toFixed(0);

      }
      updateForConfigChange(); // trigger initially
      
    </script>

  </body>
</html>
